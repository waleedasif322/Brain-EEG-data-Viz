<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.chord path {
  fill-opacity: .67;
  stroke: #000;
  stroke-width: .5px;
}

div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 150px;					
    height: 100px;					
    padding: 2px;				
    font: 12px sans-serif;		
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}

</style>
<body>

Timeline <input type="range" style="width:800px" min="1" max="139" value=1 id="range_input" />
<label for="male" id="input_label">1</label>s
</br>
<button type="button"  id="start_button">Start</button>
<button type="button"  id="stop_button">Stop</button>
</br>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="d3.js"></script>
<script>

//read file
d3.text('30fps_data.txt', function(error3, data1){
d3.text("positions.txt", function(dataa) {

	var json_frames = JSON.parse(data1);
	var poss = d3.csv.parseRows(dataa);
	

	var interval = 33; // one second
	var counter = 0;
	var dx = 0;
	var frame = 0;
	var ctr2 = 0;

	var body = d3.selectAll("body").append("div").style("float","left").style("margin-top", "150px");


	var rang = d3.selectAll("#range_input")[0][0];

	body.html("<img width='500px' height='300px' src='img/1.jpg'/>");
	var margin = {top: -55, right: 0, bottom: 0, left: -35},
    width = 1000 - margin.left - margin.right,
    height = 1000 - margin.top - margin.bottom;




	var svg = d3.select("body").append("svg")
		.attr("width", 850)
		.attr("height", 850)
		.style("background-image","url(unnamed.PNG)")
		.append("g").attr("transform", 
								"translate(" + margin.left + "," + margin.top + ")");
		
	
	var div = d3.select("body").append("div")	
				.attr("class", "tooltip")				
				.style("opacity", 0);
				

			  
	var circles = svg.selectAll("circle")
					.data(json_frames)
					.enter()
					.append("circle")
					.attr("r",function (d,i){ 
					
						if(i == 63 || i == 62){	
							return d[frame][ctr2]/3000;
						}
					
						console.log(i.toString() + d[frame][ctr2]/200);
						return d[frame][ctr2]/200;
					


					})
					.attr("cx",function(d,i){ return poss[i*2];})
					.attr("cy",function(d,i){ return poss[i*2+1];})
					.style("opacity", 0.9)
					.on("mouseover", function(d,e,i){ 
				
						
						d3.select(this)
							.transition()
							.style("opacity", 1);				
						
						div.transition()		
							.duration(200)		
							.style("opacity", .9);		
						
						console.log(e);
							
						var e1 = e +1;
						
						d3.select(this)
								.transition()
								.attr("stroke", "yellow");
						
						div.html("channel: "+ e1 + "<br/>val: "+ d[frame][ctr2]	
								)	
							.style("left", (d3.event.pageX) + "px")		
							.style("top", (d3.event.pageY - 28) + "px");

						
				
					}).on("mouseout",function(){ 
			
							d3.select(this)
								.transition()
								.attr("stroke", "black");
								
						div.transition()		
							.duration(200).style("opacity", 0);
							
					}).on("click",function(d,e,i){
				
						//this needs to be filled up by raj
								
				
					})
					.attr("fill","blue").attr("stroke","black").attr("stroke-width",3);


	var z_list = []

	for(var i =0; i<64; i++){

		var min1 = d3.min(json_frames[i]);
		
		
		var min = Math.ceil(d3.min(min1));
		var max1 = d3.max(json_frames[i]);
		var max = Math.ceil(d3.max(max1));
	
		console.log(min);
		console.log(max);

		z_list[i] = d3.scale.linear()
						.domain([min,max])
						.range(["white","red"]);
			
	}
	
	var btn_click = d3.selectAll("#start_button").on("click", function(){
	
			dx=1;
			d3.timer(makeCallback(),interval);
			
	});
	

	var btn_click2 = d3.selectAll("#stop_button").on("click", function(){
	
			dx=0;
			
	});


	var makeCallback = function() {

		return function() {
		
			if(dx>0){
			
				if(counter>1960){
				
					var vv = parseInt(rang.value) +1 ;
					var im1 = "</br><img width='500px' height='300px' src='img/"+ vv+  ".jpg'/>";
					body.html(im1);
					d3.selectAll("#input_label").html(rang.value);
				
					rang.value = parseInt(rang.value) + dx;
					
					counter=0;
					frame = rang.value;
					ctr2 = 0;
				}
				
			ctr2 = ctr2 + 1;
			
				d3.timer(makeCallback(),interval);
			
			}
			else{
			
				//d3.timer(makeCallback(),0);
			
			}
			

			
			var cols = []
			
			for(var i=0; i<64; i++){
				
				cols[i] = json_frames[i][frame][ctr2-1];
				
			}
			
			circles.attr("fill",function(d,i){
				console.log(frame);
				return z_list[i](cols[i]);	
			}).attr("r",function (d,i){ 
					
					if(i == 63 || i == 62){
					
					return cols[i]/3000;
					
					}
					return cols[i]/200;
				

					});

			cols = [];
			
			counter =  counter+33;

			return true;
		}
	};
  
	d3.selectAll("#range_input")
		.on("input", function(d,i){

					threshold_filter = this.value;			
					d3.selectAll("#input_label")
						.html(this.value);
						
					var vv = parseInt(rang.value);
					var im1 = "</br><img width='500px' height='300px' src='img/"+ vv+  ".jpg'/>";
					frame = vv;
					d3.timer(makeCallback(),0);
						body.html(im1).transition();	
											
		});	
		
		
	d3.timer(makeCallback(),interval);
	
	
	
})
});

</script>